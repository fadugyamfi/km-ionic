import{a4 as p,a5 as f,v as d,a as l}from"./index-f92ce253.js";import{O as m,a as S}from"./Order-423a7fc9.js";import{u as x}from"./BusinessStore-3612150a.js";const _=new p,h="kola.cart";x();const g=f("cart",{state:()=>({items:[],orders:[]}),actions:{async loadFromStorage(){let s=await _.get(h);return this.orders=s.map(e=>new m(e))||[],this},getProductItem(s){let e=null;return this.orders.forEach(t=>{const i=t.order_items.find(r=>r.products_id=s.id);if(i)return e=i,!1}),e},hasProduct(s){if(!s||!this.orders)return!1;let e=!1;return this.orders.forEach(t=>{if(t.order_items.findIndex(r=>r.products_id=s.id)>-1)return e=!0,!1}),e},getTotalCost(){return this.orders.reduce((s,e)=>s+e.getTotal(),0)},addProduct(s,e=1){var a,u,c;const t=d(),i=l();let r=this.orders.find(n=>n.businesses_id==s.businesses_id);r||(r=new m({businesses_id:s.businesses_id,customer_id:(a=i.activeBusiness)==null?void 0:a.id,cms_users_id:(u=i.user)==null?void 0:u.id,business:s.business}),this.orders.push(r));let o=r.order_items.find(n=>n.products_id==s.id);return o?(o.quantity=e,t.showInfo("Increased quantity in cart")):(o=new S({businesses_id:s.businesses_id,products_id:s.id,product_price:s.product_price,currency_symbol:(c=s.currency)==null?void 0:c.symbol,product_image:s.image,product_name:s.product_name,unit_price:s.product_price,quantity:e,total_price:e*(s.product_price||0),currencies_id:1,product_units_id:1}),r.order_items.push(o),t.showSuccess("Added To Cart")),this.persist(),this},removeOrderAtIndex(s){const e=this.orders.findIndex(i=>i.businesses_id==s.businesses_id);return this.orders.splice(e,1),d().showSuccess("Removed From Cart"),this.persist(),this},removeAtItemIndex(s,e){const t=this.orders.findIndex(r=>r.businesses_id==s.businesses_id);return this.orders[t].order_items.splice(e,1),d().showSuccess("Removed From Cart"),this.persist(),this},removeAtIndex(s){return this.orders.splice(s,1),d().showSuccess("Removed From Cart"),this.persist(),this},removeProduct(s){const e=this.orders.findIndex(t=>t.product.id==s.id);return e>-1?this.removeAtIndex(e):this},updateQuantity(s,e=0){},async persist(){await _.set(h,this.orders,30,"days")}}});export{g as u};
