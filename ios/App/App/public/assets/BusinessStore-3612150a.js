import{a4 as p,v as _,a5 as w,a6 as u,am as h,C as c,aY as b,a as g}from"./index-f92ce253.js";import{P as y}from"./Product-5dbe9562.js";const i=new p;_();const v=w("business",{state:()=>({businesses:null,customers:null,selectedBusiness:null,selectedToView:null,registration:{name:"",phone_number:"",location:"",business_types_id:1,business_owner_name:"",business_owner_phone:"",email:"",value:"",gps:"",country_id:83,region_id:54,city:"",currency_id:1,logo_image:"",tax_number:"",min_order_amount:0,socials:{facebook:"",twitter:"",instagram:"",website:""},attributes:{year_established:"",primary_product_category_id:"",number_of_products:"",number_of_unique_products:"",number_of_small_retailers:"",catalog_update_frequency:"",number_of_stores:"",business_is_in_large_retail_chain:"No",how_you_heard_about_kola:"",goals_and_expectation_of_kolamarket:""},user:{pin:"",pin_confirmation:""}},searchQuery:"",SearchResults:[]}),actions:{async loadCachedBusinesses(){this.businesses||(this.businesses=await i.get("kola.businesses")||[]),this.selectedBusiness||(this.selectedBusiness=await i.get("kola.store.business"))},async getCacheBusinessData(){return await i.get("businessInfo")},async cacheBusinessData(s){let e=this.getCacheBusinessData();if(e!==null){Object.assign(e,s),await i.set("businessInfo",e);return}await i.set("businessInfo",s)},async getSuppliers(s="",e={}){const t={approved_vendor:1,...e};return this.getBusinesses(s,t)},async getBusinesses(s="",e={},t=!1){try{const a=await u.get("/v2/businesses",{params:{name_like:s,...e}});if(a){const{data:n,links:r}=a.data,o=n.map(d=>new h(d));return t?this.businesses=[...this.businesses||[],...o]:this.businesses=o,this.businesses}return[]}catch(a){return c(a),[]}},async getBusiness(s){try{const e=await u.get("/v2/businesses/".concat(s));if(e){const{data:t}=e.data;return new h(t)}return null}catch(e){return c(e),null}},async getBusinessProducts(s,e=50){try{const t={businesses_id:s.id,limit:e},a=await u.get("/v2/products",{params:t});if(a){const{data:n}=a.data;return n.map(o=>new y(o))}return[]}catch(t){return c(t),[]}},async getBusinessCustomers(s,e=50,t={},a=!1){const n="kola.business.".concat(s.id,".customers");if(await i.has(n)&&!a)return(await i.get(n)).map(o=>new h(o));try{const r={limit:e,sort:"name:asc",...t},o=await u.get("/v2/businesses/".concat(s.id,"/customers"),{params:r});if(o){const{data:d}=o.data,l=d.map(m=>new h(m));return await i.set(n,l,7,"days"),l}}catch(r){c(r)}return[]},async getBusinessSaleAgents(s,e=50,t=!1){const a="kola.business.".concat(s.id,".sale-agents");if(await i.has(a)&&!t)return(await i.get(a)).map(r=>new b(r));try{const n={businesses_id:s.id,limit:e,sort:"name:asc"},r=await u.get("/v2/sale-agents",{params:n});if(r){const{data:o}=r.data,d=o.map(l=>new b(l));return await i.set(a,d,7,"days"),d}}catch(n){c(n)}return[]},async storeBusinesses(){await i.set("store.businesses",this.businesses)},async setSearchQuery(s){this.searchQuery=s,await this.clearBusinesses()},clearBusinesses(){this.businesses=[]},getSelectedBusiness(){return this.selectedBusiness},hasSelectedBusiness(){return this.selectedBusiness!=null},async clearSelectedBusiness(){this.selectedBusiness=null,await i.remove("kola.store.business")},async setSelectedBusiness(s){this.selectedBusiness=s,await i.set("kola.store.business",s)},selectDefaultBusiness(){this.setSelectedBusiness(this.businesses!=null?this.businesses[0]:null)},async createBusinessAsShopper(s){return u.post("/v2/businesses",s).then(e=>{if(e.status>=200&&e.status<300){const t=g(),a=e.data.data;return this.setSelectedBusiness(a.business),t.setActiveBusiness(a.business),t.storeOnboarded(!0),a.business}}).catch(e=>c(e))},async createBusinessAsVendor(){return u.post("/v2/businesses",this.registration).then(s=>{if(s.status>=200&&s.status<300){const e=g(),t=s.data.data;return this.setSelectedBusiness(t.business),e.setActiveBusiness(t.business),e.storeOnboarded(!0),t.business}}).catch(s=>c(s))},async loadCachedRegistrationInfo(){await i.has("kola.business-registration")&&(this.registration=await i.get("kola.business-registration"))},async cacheRegistrationInfo(){await i.set("kola.business-registration",this.registration,3,"days")},async clearCachedRegistrationInfo(){await i.remove("kola.business-registration")},async addToFavorites(s){const e=_();s.addToFavorites();try{const a=(await u.post("/v2/businesses/".concat(s.id,"/favorites"))).data.data;s.addToFavorites({businesses_id:s.id,cms_users_id:a.cms_users_id}),e.showSuccess("Added To Favorites"),this.persist()}catch(t){c(t),s.unfavorite()}},persist(){this.storeBusinesses()},async removeFromFavorites(s){const e=_();s.unfavorite();try{const t=await u.delete("/v2/businesses/".concat(s.id,"/favorites"));e.showError("Removed From Favorites"),this.persist()}catch(t){c(t),s.addToFavorites()}},viewBusiness(s){this.selectedToView=s},getSelectedForViewing(){return this.selectedToView}}});export{v as u};
