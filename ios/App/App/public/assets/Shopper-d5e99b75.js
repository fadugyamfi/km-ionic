import{d as C,y as B,u as P,v as g,z as S,a as U,c as d,w as l,b as e,o as m,e as i,p as $,F as N,j as A,G as T,k as F,f as c,l as p,K as f,r as L,L as q,M as E,g as _,t as I,I as z,m as H,n as K,h as R,i as Y,C as x}from"./index-f92ce253.js";import{K as G}from"./KolaYellowButton-490da95d.js";import{u as O}from"./BusinessStore-3612150a.js";import{u as j}from"./form-59f00665.js";import{u as D}from"./useGeolocation-a393827f.js";import{P as h}from"./PinEntryField-06300d43.js";import"./Product-5dbe9562.js";import"./index-ee3c01c5.js";const M=c("h3",null,"You Are Almost There",-1),W=c("p",{class:"ion-margin-bottom",style:{"font-size":"0.8em"}}," Please enter your details below to finish setting up your account ",-1),ie=C({__name:"Shopper",setup(J){let u=B(!1);const V=P(),r=g(),o=j({name:"",business_location:"",business_name:"",pin:"",pin_confirmation:""}),y=S(()=>{const a=o.fields;return a.name.length>0&&a.business_name.length>0&&a.business_location.length>0&&a.pin.length==4&&isNaN(Number(a.pin))==!1&&a.pin==a.pin_confirmation}),k=O(),t=U(),v=async()=>{var a,s,n;u.value=!0,r.blockUI("Hold On As We Create Your Business");try{await k.createBusinessAsShopper({name:o.fields.business_name,location:o.fields.business_location,phone_number:(a=t.user)==null?void 0:a.phone_number,business_types_id:1,business_owner_name:o.fields.name,business_owner_phone:(s=t.user)==null?void 0:s.phone_number})?(await t.changePin({phone_number:(n=t.user)==null?void 0:n.phone_number,pin:o.fields.pin,pin_confirmation:o.fields.pin_confirmation}),await t.fetchUserInfo(),await t.fetchUserBusinesses(),V.push("/shopper")):(r.unblockUI(),r.showError("Account Registration Failed. Please try again","","bottom","footer"))}catch(b){x(b)}finally{u.value=!1,r.unblockUI()}},w=async()=>{const a=g(),{getCurrentLocation:s}=D();try{const n=await s();n&&(o.fields.business_location="".concat(n.coords.latitude,", ").concat(n.coords.longitude))}catch(n){a.showError("Cannot retrieve location info"),console.log(n)}};return(a,s)=>(m(),d(e(Y),null,{default:l(()=>[i(e(F),{class:"ion-no-border"},{default:l(()=>[i(e($),null,{default:l(()=>[i(e(N),{slot:"start"},{default:l(()=>[i(e(A),{defaultHref:"/signup"})]),_:1}),i(e(T))]),_:1})]),_:1}),i(e(z),{class:"ion-padding"},{default:l(()=>[M,W,c("form",null,[i(e(p),{class:f(["kola-input ion-margin-bottom",{"ion-invalid ion-touched":e(o).errors.name}]),label:a.$t("signup.shopper.fullName"),labelPlacement:"stacked",fill:"solid",modelValue:e(o).fields.name,"onUpdate:modelValue":s[0]||(s[0]=n=>e(o).fields.name=n),name:"name",onIonInput:s[1]||(s[1]=n=>e(o).validate(n)),required:""},null,8,["class","label","modelValue"]),i(e(p),{class:f(["kola-input ion-margin-bottom",{"ion-invalid ion-touched":e(o).errors.business_name}]),label:a.$t("signup.shopper.businessName"),labelPlacement:"stacked",fill:"solid",modelValue:e(o).fields.business_name,"onUpdate:modelValue":s[2]||(s[2]=n=>e(o).fields.business_name=n),name:"business_name",onIonInput:s[3]||(s[3]=n=>e(o).validate(n)),required:""},null,8,["class","label","modelValue"]),i(e(p),{class:f(["kola-input",{"ion-invalid ion-touched":e(o).errors.business_location}]),label:a.$t("signup.shopper.businessLocation"),labelPlacement:"stacked",fill:"solid",modelValue:e(o).fields.business_location,"onUpdate:modelValue":s[4]||(s[4]=n=>e(o).fields.business_location=n),name:"business_location",onIonInput:s[5]||(s[5]=n=>e(o).validate(n)),required:""},null,8,["class","label","modelValue"]),i(e(L),{fill:"clear",color:"primary",style:{"text-transform":"none"},class:"ion-margin-bottom ion-text-start",onClick:s[6]||(s[6]=n=>w())},{default:l(()=>[i(e(q),{icon:e(E),style:{"margin-right":"5px"}},null,8,["icon"]),_(" "+I(a.$t("signup.vendor.location.useCurrentLocation")),1)]),_:1}),i(h,{name:"pin",label:a.$t("signup.shopper.newPinCode"),modelValue:e(o).fields.pin,"onUpdate:modelValue":s[7]||(s[7]=n=>e(o).fields.pin=n)},null,8,["label","modelValue"]),i(h,{name:"pin_confirmation",label:a.$t("signup.shopper.confirmPinCode"),modelValue:e(o).fields.pin_confirmation,"onUpdate:modelValue":s[8]||(s[8]=n=>e(o).fields.pin_confirmation=n)},null,8,["label","modelValue"])])]),_:1}),i(e(R),{class:"ion-padding ion-no-border",id:"footer"},{default:l(()=>[i(G,{disabled:!y.value,onClick:v},{default:l(()=>[e(u)?(m(),d(e(H),{key:0,name:"crescent"})):(m(),d(e(K),{key:1},{default:l(()=>[_(I(a.$t("general.continue")),1)]),_:1}))]),_:1},8,["disabled"])]),_:1})]),_:1}))}});export{ie as default};
