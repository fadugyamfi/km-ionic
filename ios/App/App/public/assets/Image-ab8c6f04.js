import{d as m,Q as p,ac as l,a4 as g,_ as h,x as I,o as u,c as f}from"./index-f92ce253.js";import{F as n,D as i}from"./index-bde9bf13.js";const c=new g,w=m({components:{IonImg:p,IonSkeletonText:l},props:{src:{type:String},noImgSrc:{default:"/images/no-image.png",type:String}},data(){return{loaded:!1,imageData:null}},emits:["loaded"],methods:{onLoadError(e){e.target.src=this.noImgSrc},onLoaded(){this.loaded=!0,this.$emit("loaded")},async convertBlobToBase64(e){return new Promise((a,o)=>{const t=new FileReader;t.onerror=o,t.onload=()=>{a(t.result)},t.readAsDataURL(e)})},async loadImage(){if(!this.src)return;if(this.src.includes(";base64")){this.imageData=this.src;return}const e=this.src,a=e.split("/").pop()||(crypto==null?void 0:crypto.randomUUID())||"img-"+new Date().getTime();a==null||a.split(".").pop();const o=await c.get("image:".concat(e));if(o){const s=await n.readFile({path:o.filepath,directory:i.Cache});if(s){this.imageData="".concat(s.data);return}}const t=await this.saveImage(e,a);this.imageData="".concat(t.base64Data),c.set("image:".concat(e),{filepath:t.filepath,webviewPath:t.webviewPath},1,"year")},async saveImage(e,a){const t=await(await fetch(e)).blob(),s=await this.convertBlobToBase64(t);return await n.writeFile({path:a,data:s,directory:i.Cache}),{filepath:a,webviewPath:e,base64Data:s}}},mounted(){setTimeout(()=>{this.imageData=this.src},200)}});function D(e,a,o,t,s,_){const d=I("IonImg");return u(),f(d,{src:e.imageData||e.noImgSrc,onIonError:a[0]||(a[0]=r=>e.onLoadError(r)),onIonImgDidLoad:a[1]||(a[1]=r=>e.onLoaded())},null,8,["src"])}const v=h(w,[["render",D],["__scopeId","data-v-932e4132"]]);export{v as I};
