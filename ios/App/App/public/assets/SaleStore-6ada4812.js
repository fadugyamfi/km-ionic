var S=Object.defineProperty;var m=(t,e,i)=>e in t?S(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var s=(t,e,i)=>(m(t,typeof e!="symbol"?e+"":e,i),i);import{am as _,a4 as w,a5 as y,a as o,a6 as d,C as c}from"./index-f92ce253.js";import{P as p}from"./Product-5dbe9562.js";import{f as u}from"./Date-1419e6d2.js";const g=1,b=5,l={CASH_SALE:g,CREDIT_SALE:b};class f{constructor(e){s(this,"id");s(this,"name");s(this,"description");Object.assign(this,e)}}class r{constructor(e){s(this,"id");s(this,"businesses_id");s(this,"cms_users_id");s(this,"sale_types_id");s(this,"payment_modes_id");s(this,"customer_id");s(this,"credits_id");s(this,"gps_location");s(this,"delivery_location");s(this,"product_units_id");s(this,"sale_started_at");s(this,"sale_ended_at");s(this,"total_items",0);s(this,"total_sales_price",0);s(this,"total_discount",0);s(this,"created_at");s(this,"sale_items",[]);s(this,"sale_items_count",0);s(this,"_product");s(this,"_business");s(this,"_customer");s(this,"_saleType");this.update(e)}update(e){Object.assign(this,e)}isCreditSale(){return this.sale_types_id==l.CREDIT_SALE}isCashSale(){return this.sale_types_id==l.CASH_SALE}get product(){return this._product}set product(e){this._product=e?new p(e):null}get customer(){return this._customer}set customer(e){this._customer=e?new _(e):null}get business(){return this._business}set business(e){this._business=e?new _(e):null}get sale_type(){return this._saleType}set sale_type(e){this._saleType=e?new f(e):null}}class x{constructor(e){s(this,"id");s(this,"businesses_id");s(this,"products_id");s(this,"quantity",0);s(this,"unit_price",0);s(this,"total_price",0);s(this,"_product");this.update(e)}update(e){Object.assign(this,e)}get product(){return this._product}set product(e){this._product=e?new p(e):null}}new w;const E=y("sale",{state(){return{newSale:new r({}),sales:[]}},actions:{resetForNewSale(){var e,i;const t=o();this.newSale=new r({businesses_id:(e=t.activeBusiness)==null?void 0:e.id,cms_users_id:(i=t.user)==null?void 0:i.id,credits_id:1,gps_location:"-",delivery_location:"Ghana",product_units_id:1,payment_modes_id:1,sale_types_id:1,sale_started_at:u(new Date().toISOString()),sale_ended_at:"",total_items:0,total_sales_price:0,total_discount:0,description:""})},addProductToSale(t){var i;const e=new x({quantity:1,unit_price:t.product_price,total_price:t.product_price,products_id:t.id,product:t,product_units_id:1,currencies_id:1,cms_users_id:this.newSale.cms_users_id,businesses_id:this.newSale.businesses_id,description:"",is_on_sale:0});(i=this.newSale.sale_items)==null||i.push(e)},removeProductFromSale(t){var i,a;const e=(i=this.newSale.sale_items)==null?void 0:i.findIndex(n=>n.products_id==t.id);(a=this.newSale.sale_items)==null||a.splice(e,1)},isProductSelected(t){var i;const e=(i=this.newSale.sale_items)==null?void 0:i.findIndex(a=>a.products_id==t.id);return isNaN(e)?!1:e>-1},async recordSale(){return this.newSale.update({sale_ended_at:u(new Date().toISOString())}),d.post("/v2/sales",this.newSale).then(t=>{const e=new r(t.data.data);return this.sales.unshift(e),e}).catch(t=>(c(t),null))},async fetchSales(t={}){var a;const i={businesses_id:(a=o().activeBusiness)==null?void 0:a.id,limit:50,...t};return d.get("/v2/sales",{params:i}).then(n=>(this.sales=n.data.data.map(h=>new r(h)),this.sales)).catch(n=>(c(n),[]))},async fetchSale(t,e={}){const i={...e};return d.get("/v2/sales/".concat(t),{params:i}).then(a=>new r(a.data.data)).catch(a=>(c(a),null))},async deleteSale(t){return d.delete("/v2/sales/".concat(t.id)).then(()=>{const e=this.sales.findIndex(i=>i.id==t.id);e>-1&&this.sales.splice(e,1)}).catch(e=>{c(e)})}}});export{f as S,E as u};
